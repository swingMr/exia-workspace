<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.excellence.iamp.dao.TagRecordDao" >
  <resultMap id="result" type="com.excellence.iamp.vo.TagRecord" >
    <id column="record_id" property="recordId" jdbcType="VARCHAR" />
    <result column="subject_name" property="subjectName" jdbcType="VARCHAR" />
    <result column="subject_id" property="subjectId" jdbcType="VARCHAR" />
    <result column="subject_account" property="subjectAccount" jdbcType="VARCHAR" />
    
    <result column="tag_code" property="tagCode" jdbcType="VARCHAR" />
    <result column="tag_type" property="tagType" jdbcType="VARCHAR" />
    <result column="tag_name" property="tagName" jdbcType="VARCHAR" />
    <result column="num" property="num" jdbcType="INTEGER" />
    <result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
    <result column="update_date" property="updateDate" jdbcType="TIMESTAMP" />
    <result column="update_date_str" property="updateDateStr" jdbcType="VARCHAR" />    
  </resultMap>
  <select id="get" resultMap="result" parameterType="java.lang.String" >
    select record_id, subject_name, subject_id, subject_account, tag_code, tag_type, tag_name, num, create_date, update_date,update_date_str
    from ia_tag_record
    where record_id = #{recordId}
  </select>
  <delete id="delete" parameterType="java.lang.String" >
    delete from ia_tag_record
    where record_id = #{recordId}
  </delete>
  <insert id="insert" parameterType="com.excellence.iamp.vo.TagRecord" >
    insert into ia_tag_record (record_id, subject_name, subject_id,subject_account, tag_code, tag_type, tag_name, num, create_date,
      update_date,update_date_str)
    values (#{recordId}, #{subjectName}, #{subjectId},#{subjectAccount}, #{tagCode}, #{tagType},
      #{tagName}, #{num}, #{createDate}, #{updateDate},#{updateDateStr})
  </insert>
  
  <update id="update" parameterType="com.excellence.iamp.vo.TagRecord" >
    update ia_tag_record
    <trim prefix="set" suffixOverrides=",">
      <if test="subjectName !='' and subjectName != null">
        subject_name = #{subjectName}, 
      </if>
      <if test="subjectId !='' and subjectId != null">
        subject_id = #{subjectId}, 
      </if>
      <if test="subjectAccount !='' and subjectAccount != null">
        subject_account = #{subjectAccount}, 
      </if>
      <if test="tagType !='' and tagType != null">
        tag_type = #{tagType}, 
      </if>
      <if test="tagName !='' and tagName != null">
        tag_name = #{tagName}, 
      </if>
      <if test="num !='' and num != null">
        num = #{num}, 
      </if>
      <if test="createDate !='' and createDate != null">
        create_date = #{createDate}, 
      </if>
      <if test="updateDate !='' and updateDate != null">
        update_date = #{updateDate}, 
      </if>
      <if test="updateDateStr !='' and updateDateStr != null">
        update_date_str = #{updateDateStr}, 
      </if> 
    </trim>
    where record_id = #{recordId}
  </update>
  
	<sql id="conditionFragment">  
		<where>
			<if test="subjectId !='' and subjectId != null">subject_id=#{subjectId} </if>
			<if test="subjectName !='' and subjectName != null">subject_name=#{subjectName} </if>
			<if test="subjectAccount !='' and subjectAccount != null">subject_account=#{subjectAccount} </if>
			<if test="tagType !='' and tagType != null"> and tag_type=#{tagType}</if>
			<if test="tagName !='' and tagName != null"> and tag_name=#{tagName} </if> 
			<if test="beginDate !='' and beginDate != null"> and create_date>=#{beginDate} </if>
			<if test="endDate !='' and endDate != null"> and create_date &lt;= #{endDate}</if>
		</where>  
	</sql>
  <select id="getDistinctSubId" resultType="java.lang.String" >
    select DISTINCT subject_id from ia_tag_record
  </select>
  <select id="getAllTagTypes" resultType="java.lang.String" >
    select tag_type from ia_tag_record GROUP BY tag_type 
  </select>
  <select id="getRankRecords" resultMap="result" parameterType="java.lang.String">
      select * from ia_tag_record  where
	  subject_id = #{subjectId} and
	 tag_type in('领域','主体','行为','客体','时间','空间','表象','根源','目标','指标','其它内容')
	 order by update_date_str desc , num desc
   </select>

  	<select id="getTagRecordByConditionCount" resultType="java.lang.Integer" parameterType="java.util.Map">
      select count(1) from ia_tag_record 
      <include refid="conditionFragment" />
	</select>
  <select id="getTagRecordByCondition" resultMap="result" parameterType="java.util.Map" >
    select record_id, subject_name, subject_id,subject_name,tag_code, tag_type, tag_name, num, create_date, update_date,update_date_str
    from ia_tag_record
    <include refid="conditionFragment" />
    order by num desc
  </select>
  
  <select id="getTagRecordLimit" resultMap="result" parameterType="java.util.Map" >
    select DISTINCT tag_name,num from ia_tag_record ORDER BY num desc limit 5
  </select>
  
  <select id="getTagRecordListBySubIdAndType" resultMap="result"  parameterType="java.util.Map" >
    select record_id, subject_name, subject_id,subject_name, tag_type, tag_name, num, create_date, update_date,update_date_str
    from ia_tag_record   
    <include refid="conditionFragment" />
  </select>
  
</mapper>